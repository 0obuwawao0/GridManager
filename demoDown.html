<html>
<head>
<script type="text/javascript" language="javascript">
        var idTmr;
		function  getExplorer() {
			var explorer = window.navigator.userAgent ;
			//ie 
			if (explorer.indexOf("MSIE") >= 0) {
				return 'ie';
			}
			//firefox 
			else if (explorer.indexOf("Firefox") >= 0) {
				return 'Firefox';
			}
			//Chrome
			else if(explorer.indexOf("Chrome") >= 0){
				return 'Chrome';
			}
			//Opera
			else if(explorer.indexOf("Opera") >= 0){
				return 'Opera';
			}
			//Safari
			else if(explorer.indexOf("Safari") >= 0){
				return 'Safari';
			}
		}
        function method1(tableid) {//整个表格拷贝到EXCEL中
			if(getExplorer()=='ie')
			{
				var curTbl = document.getElementById(tableid);
				var oXL = new ActiveXObject("Excel.Application");
				
				//创建AX对象excel 
				var oWB = oXL.Workbooks.Add();
				//获取workbook对象 
				var xlsheet = oWB.Worksheets(1);
				//激活当前sheet 
				var sel = document.body.createTextRange();
				sel.moveToElementText(curTbl);
				//把表格中的内容移到TextRange中 
				sel.select();
				//全选TextRange中内容 
				sel.execCommand("Copy");
				//复制TextRange中内容  
				xlsheet.Paste();
				//粘贴到活动的EXCEL中       
				oXL.Visible = true;
				//设置excel可见属性

				try {
					var fname = oXL.Application.GetSaveAsFilename("Excel.xls", "Excel Spreadsheets (*.xls), *.xls");
				} catch (e) {
					print("Nested catch caught " + e);
				} finally {
					oWB.SaveAs(fname);

					oWB.Close(savechanges = false);
					//xls.visible = false;
					oXL.Quit();
					oXL = null;
					//结束excel进程，退出完成
					//window.setInterval("Cleanup();",1);
					idTmr = window.setInterval("Cleanup();", 1);

				}
				
			}
			else
			{
				tableToExcel(tableid, 'aaaaaaaaa')
			}
        }
        function Cleanup() {
            window.clearInterval(idTmr);
            CollectGarbage();
        }
		var tableToExcel = (function() {
			  var uri = 'data:application/vnd.ms-excel;base64,',
			  template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body><table>{table}</table></body></html>',
				base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) },
				format = function(s, c) {
					return s.replace(/{(\w+)}/g,function(m, p) {
						return c[p]; 
					});
				}
				return function(table, name) {
				console.log(name)
					if (!table.nodeType) table = document.getElementById(table)
					var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
					var test2 = document.getElementById('test2');
					test2.setAttribute('href', uri + base64(format(template, ctx)));
					test2.click();
				//	window.location.href = uri + base64(format(template, ctx))
				//	window.open( uri + base64(format(template, ctx)))
			  }
			})()
    </script>

</head>
<body>
<table id="targetTable">
	<thead>
	  <tr align="center">
		<th>标识</th>
		<th>内容</th>
		<th>创建时间</th>
		<th>最后修改时间</th>
		<th>最打开打时间</th>
		<th>用户名</th>
		<th>密码</th>
	  </tr>
	</thead>
	<tbody>
  <tr align="center">
	<td>1</td>
	<td>excel导出01</td>
	<td>2015-07-22</td>
	<td>2015-07-22</td>
	<td>2015-07-22</td>
	<td>baukh</td>
	<td>1</td>
  </tr>
  <tr align="center">
	<td>2</td>
	<td>excel导出01</td>
	<td>2015-07-22</td>
	<td>2015-07-22</td>
	<td>2015-07-22</td>
	<td>baukh</td>
	<td>1</td>
  </tr>
  </tbody>
</table>
</br>
<input id="Button1" type="button" value="导出EXCEL" 
        onclick="javascript:method1('targetTable')" />
		<a href="" download="abc.xls" id="test2">试一下</a>
</body>
</html>